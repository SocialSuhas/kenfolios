<!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="utf-8" />
  <title>KenFolios · WhatsApp Group Registration</title>
  <meta name="viewport" content="width=device-width, initial-scale=1" />

  <style>
    :root{
      --kf-red:#E11D2E;
      --border:#e5e7eb;
      --bg:#f8fafc;
      --text:#0f172a;
      --muted:#64748b;
    }

    *{box-sizing:border-box}
    body{
      margin:0;
      font-family:system-ui,-apple-system,Segoe UI,Roboto,Ubuntu,Helvetica,Arial;
      background:var(--bg);
      color:var(--text);
    }

    .page{
      max-width:760px;
      margin:3rem auto;
      padding:0 1rem;
    }

    .card{
      background:#fff;
      border:1px solid var(--border);
      border-radius:16px;
      padding:1.5rem 1.75rem;
      box-shadow:0 10px 30px rgba(15,23,42,.05);
    }

    h1{
      font-size:22px;
      margin:0 0 .25rem 0;
    }

    .sub{
      font-size:14px;
      color:var(--muted);
      margin-bottom:1.25rem;
    }

    .note{
      background:#f8fafc;
      border:1px solid var(--border);
      border-radius:12px;
      padding:.75rem .9rem;
      font-size:13px;
      color:var(--muted);
      margin-bottom:1.25rem;
    }

    .note strong{color:var(--text)}

    form{
      display:grid;
      gap:1rem;
    }

    .field{
      display:flex;
      flex-direction:column;
      gap:.35rem;
    }

    label{
      font-size:13px;
      font-weight:700;
      color:var(--muted);
    }

    input, textarea{
      border:1px solid var(--border);
      border-radius:10px;
      padding:.6rem .7rem;
      font-size:15px;
      font-family:inherit;
    }

    textarea{resize:vertical; min-height:90px}

    .hint{
      font-size:12px;
      color:var(--muted);
    }

    .actions{
      display:flex;
      justify-content:center;
      margin-top:.5rem;
    }

    button{
      height:46px;
      min-width:220px;
      border-radius:11px;
      border:1px solid var(--kf-red);
      background:var(--kf-red);
      color:#fff;
      font-weight:800;
      font-size:15px;
      cursor:pointer;
    }

    button:disabled{
      opacity:.6;
      cursor:not-allowed;
    }

    .status{
      margin-top:1rem;
      font-size:14px;
      text-align:center;
    }

    .status.ok{color:#16a34a}
    .status.err{color:#dc2626}
  </style>
</head>

<body>
  <div class="page">
    <div class="card">
      <h1>Register a WhatsApp Group</h1>
      <div class="sub">KenFolios Community · Members Only</div>

      <div class="note">
        <strong>Important:</strong><br>
        • Only <strong>paid KenFolios members</strong> can submit requests<br>
        • Group name must start with <strong>KenFolios</strong><br>
        • Only <strong>free WhatsApp groups</strong> are allowed currently<br>
        • All requests are <strong>manually reviewed</strong> before approval
      </div>

      <form id="waGroupForm">
        <div class="field">
          <label>Full Name</label>
          <input required name="full_name" />
        </div>

        <div class="field">
          <label>Email (same as community account)</label>
          <input type="email" required name="email" />
        </div>

        <div class="field">
          <label>WhatsApp Group Name</label>
          <input required name="group_name"
            placeholder="KenFolios Mumbai Tech Entrepreneurs" />
          <div class="hint">Must start with “KenFolios”</div>
        </div>

        <div class="field">
          <label>Group Description / Purpose</label>
          <textarea required name="group_description"
            placeholder="Clearly state the professional goal of this group"></textarea>
        </div>

        <div class="field">
          <label>WhatsApp Group Join Link</label>
          <input required name="group_join_link"
            placeholder="https://chat.whatsapp.com/…" />
        </div>

        <div class="actions">
          <button type="submit">Submit for Review</button>
        </div>

        <div id="status" class="status"></div>
      </form>
    </div>
  </div>

  <script>
    const form = document.getElementById('waGroupForm');
    const statusBox = document.getElementById('status');

    form.addEventListener('submit', async (e) => {
      e.preventDefault();
      statusBox.textContent = '';
      statusBox.className = 'status';

      const btn = form.querySelector('button');
      btn.disabled = true;

      const data = Object.fromEntries(new FormData(form).entries());

      if (!data.group_name.startsWith('KenFolios')) {
        statusBox.textContent = "Group name must start with 'KenFolios'.";
        statusBox.classList.add('err');
        btn.disabled = false;
        return;
      }

      try {
        const res = await fetch(
          'https://kf-wa-groups-worker-crimson-fog-7c02.ksn-nvl.workers.dev/',
          {
            method: 'POST',
            headers: { 'Content-Type': 'application/json' },
            body: JSON.stringify(data)
          }
        );

        const json = await res.json();

        if (!res.ok) throw json;

        statusBox.textContent =
          "Request submitted successfully. Please check your email to verify.";
        statusBox.classList.add('ok');
        form.reset();

      } catch (err) {
        statusBox.textContent =
          err?.error || 'Something went wrong. Please try again.';
        statusBox.classList.add('err');
      } finally {
        btn.disabled = false;
      }
    });
  </script>
</body>
</html>
