<!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="utf-8" />
  <title>KenFolios WhatsApp Groups</title>
  <meta name="viewport" content="width=device-width, initial-scale=1" />

  <!-- INLINE SVG FAVICON -->
  <link
    rel="icon"
    type="image/svg+xml"
    href="data:image/svg+xml;utf8,
<svg xmlns='http://www.w3.org/2000/svg' viewBox='0 0 64 64'>
  <rect width='64' height='64' rx='12' ry='12' fill='%23E11D2E'/>
  <text x='32' y='50' text-anchor='middle'
    font-size='44' font-weight='900'
    font-family='system-ui,Segoe UI,Roboto,Arial'
    fill='white'>KF</text>
</svg>"
  />

  <style>
    :root{
      --kf-red:#E11D2E;
      --text:#0f172a;
      --muted:#64748b;
      --border:#e5e7eb;
      --bg:#f8fafc;
      --pill:#f1f5f9;
    }
    *{box-sizing:border-box}
    body{
      margin:0;
      font-family:system-ui,-apple-system,Segoe UI,Roboto,Arial;
      color:var(--text);
      background:var(--bg);
    }
    header{background:#fff}
    .header-inner{max-width:1200px;margin:0 auto;padding:16px 20px 6px;display:flex;align-items:center}
    .kf-community-logo{height:44px;display:block}

    .hero{background:#fff;padding:52px 0 72px}
    .hero-inner{max-width:1200px;margin:0 auto;padding:0 20px}

    .cta{display:inline-block;background:var(--kf-red);color:#fff;padding:14px 28px;border-radius:999px;font-weight:800;text-decoration:none}

    .section{padding:72px 0 96px}
    .wrap{max-width:1200px;margin:0 auto;padding:0 20px}

    h2{font-size:26px;margin-bottom:12px;font-weight:900}

    .grid{display:grid;grid-template-columns:repeat(auto-fill,minmax(260px,1fr));gap:20px}

    .card{
      background:#fff;
      border:1px solid var(--border);
      border-radius:18px;
      padding:18px;
      cursor:pointer
    }
    .card.upcoming{
      background:#f8fafc;
      border-style:dashed;
      opacity:.75;
      cursor:default
    }

    .card-title{font-weight:800;font-size:16px}
    .card-meta{font-size:13px;color:var(--muted)}
    .card-status{margin-top:12px;font-size:12px;font-weight:800;color:#92400e}

    /* ===== Group Detail Enhancements ===== */
    .detail-card{
      background:#fff;
      border:1px solid var(--border);
      border-radius:20px;
      padding:28px;
    }

    .detail-header{
      display:flex;
      align-items:center;
      gap:12px;
      flex-wrap:wrap;
    }

    .status-pill{
      font-size:12px;
      font-weight:800;
      padding:6px 12px;
      border-radius:999px;
      background:var(--pill);
      color:#065f46;
    }

    .back-link{
      display:inline-block;
      margin-bottom:18px;
      font-size:14px;
      color:var(--muted);
      text-decoration:none;
      font-weight:600;
    }

    .divider{
      height:1px;
      background:var(--border);
      margin:22px 0;
    }

    .meta-block{margin-top:14px;font-size:14px}

    .members-box{
      background:#f9fafb;
      border:1px solid var(--border);
      border-radius:14px;
      padding:14px 18px;
      margin-top:10px;
      max-height:260px;
      overflow:auto;
    }

    .members-list{
      margin:8px 0 0;
      padding-left:18px;
      font-size:14px;
    }
  </style>
</head>

<body>

<header>
  <div class="header-inner">
    <svg class="kf-community-logo" xmlns="http://www.w3.org/2000/svg" viewBox="0 0 360 64">
      <rect width="64" height="64" rx="14" fill="#E11D2E"/>
      <text x="32" y="52" text-anchor="middle" font-size="46" font-weight="900" fill="#fff">KF</text>
      <text x="76" y="30" font-size="22" font-weight="900" fill="#0f172a">KenFolios</text>
      <text x="76" y="54" font-size="17" font-weight="800" fill="#0f172a">Business Community</text>
    </svg>
  </div>
</header>

<section class="section" id="groupDetail" style="display:none">
  <div class="wrap">

    <a class="back-link" href="/wagroups">← Back to Groups Directory</a>

    <div class="detail-card">

      <div class="detail-header">
        <h2 id="gdName"></h2>
        <span id="gdStatus" class="status-pill"></span>
      </div>

      <p id="gdDesc" class="card-meta"></p>

      <div class="divider"></div>

      <div id="gdModerators" class="meta-block"></div>

      <div class="meta-block">
        <strong>Members (<span id="memberCount">0</span>)</strong>
        <div class="members-box">
          <ul id="gdMembers" class="members-list"></ul>
        </div>
      </div>

      <a id="joinBtn" class="cta" style="margin-top:24px;display:none">
        Join WhatsApp Group
      </a>

    </div>
  </div>
</section>

<script>
  const params = new URLSearchParams(location.search);
  const groupId = params.get('group_id');
  if(groupId){
    document.getElementById('groupDetail').style.display='block';
    loadGroup(groupId);
  }

  async function loadGroup(id){
    const res = await fetch('/api/wa-groups/group?group_id='+id);
    const g = await res.json();

    document.getElementById('gdName').textContent = g.name;
    document.getElementById('gdDesc').textContent = g.description;

    const statusEl = document.getElementById('gdStatus');
    statusEl.textContent = g.status === 'approved' ? 'Active' : g.status;

    const modBox = document.getElementById('gdModerators');
    if(g.moderated_by?.length){
      modBox.innerHTML =
        '<strong>Moderated by:</strong> ' +
        g.moderated_by.map(m =>
          m.full_name + (m.city ? ' ('+m.city+')' : '')
        ).join(', ');
    }

    const list = document.getElementById('gdMembers');
    list.innerHTML='';
    document.getElementById('memberCount').textContent = g.members?.length || 0;

    g.members?.forEach(m=>{
      const li=document.createElement('li');
      li.textContent = m.full_name + (m.city ? ' – '+m.city : '');
      list.appendChild(li);
    });

    if(g.status === 'approved'){
      const btn=document.getElementById('joinBtn');
      btn.style.display='inline-block';
      btn.href='/api/wa-groups/join?group_id='+id;
    }
  }
</script>

</body>
</html>
